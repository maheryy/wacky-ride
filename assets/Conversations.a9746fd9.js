import{f as w,l as S,g as E,h as I,x as V,y as _,m as B,n as N,r as D,o as d,c,a as r,b as h,w as v,d as L,p as C,F as T,z as U,A as k,q as x,k as F,B as M,s as R,t as j,_ as q}from"./index.95d509c3.js";const y=u=>(R("data-v-e9d6b910"),u=u(),j(),u),z={class:"main-container wacky-tile"},O={id:"conversations",class:"community"},b=y(()=>r("h3",null,"Conversations",-1)),G={key:0},H={key:0,class:"status"},J={class:"show-ended-conversations"},K=y(()=>r("label",{for:"ended-conversations"},"Afficher les conversations termin\xE9es",-1)),P=w({__name:"Conversations",setup(u){const i=S(),n=E().socket,a=I(),l=V(!1),f=_(()=>Object.values(i.conversations)),A=_(()=>l.value?f.value:f.value.filter(t=>!(t!=null&&t.endedAt))),g=_(()=>A.value.sort((t,e)=>(t==null?void 0:t.endedAt)&&(e==null?void 0:e.endedAt)?0:t!=null&&t.endedAt?1:e!=null&&e.endedAt?-1:0));return B(()=>{n.emit("conversations"),n.on("conversations",({data:t,errors:e})=>{if(e){for(const o of e)a.error(o.message);return}i.updateConversations(t.conversations)}),n.on("contact:accepted",({data:t,errors:e})=>{if(e){for(const o of e)a.error(o.message);return}a.success("Un conseiller \xE0 accepter votre demande"),i.setConversation(t.conversation)}),n.on("contact:refused",({data:t,errors:e})=>{if(e){for(const o of e)a.error(o.message);return}a.warning("Aucun conseiller ne peut vous contacter pour le moment")}),n.on("conversation:ended",({data:t,errors:e})=>{if(e){for(const o of e)a.error(o.message);return}i.updateConversation(t.conversation)})}),N(()=>{n.off("conversations"),n.off("contact:accepted"),n.off("contact:refused"),n.off("conversation:ended")}),(t,e)=>{const o=D("RouterLink");return d(),c("div",z,[r("section",O,[r("header",null,[h(o,{to:"/community",class:"back"},{default:v(()=>[L("\u1438")]),_:1}),b]),C(f).length?(d(),c("ul",G,[(d(!0),c(T,null,U(C(g),s=>(d(),c("li",{key:s==null?void 0:s.id},[h(o,{to:{name:"conversation",params:{conversationId:s==null?void 0:s.id}}},{default:v(()=>{var p,m;return[r("span",null,k((p=s==null?void 0:s.receiver)==null?void 0:p.username)+" "+k((m=s==null?void 0:s.receiver)!=null&&m.isAdmin?"(Conseiller)":""),1),s!=null&&s.endedAt?(d(),c("span",H,"Termin\xE9")):x("",!0)]}),_:2},1032,["to"])]))),128))])):x("",!0),r("div",J,[F(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),type:"checkbox",id:"ended-conversations"},null,512),[[M,l.value]]),K])])])}}});const X=q(P,[["__scopeId","data-v-e9d6b910"]]);export{X as default};
